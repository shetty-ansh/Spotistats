<div id="MainContainer">
  <div id="Header">
    <!-- <div id="ProfielSection">
      <div id="ProfileImage">
        <img *ngIf="profile.images?.length" [src]="profile.images[0].url" />
      </div>
      <div id="ProfileInfo">
        <p id="Name">{{ profile.display_name }}</p>
        <p id="Country">{{ profile.country }}</p>
      </div>
    </div> -->

  </div>

  <div id="displayContent">
    <div class="carousel-display" *ngIf="topTracksShort.length && topTracks">
      <div id="ToggleContainer">
        <div class="switch-container" [class.switched]="isToggled" (click)="toggleSwitch()">
          <div class="switch-slider"></div>
          <div class="switch-options">
            <div class="switch-option" [class.active]="!isToggled">Last Month</div>
            <div class="switch-option" [class.active]="isToggled">6 Months</div>

          </div>
        </div>
      </div>
      <div id="carousel-container">
        <button class="nav-button left" (click)="prevSlide()">‹</button>
        <div class="carousel-track">
          <div class="carousel-card" *ngFor="let track of visibleTracks(); let i = index" [ngClass]="getCardClass(i)">
            <div id="Image">
              <img [src]="track.album.images[0]?.url" alt="Track Image" />
              <div class="track-badge">{{ i }}</div>
            </div>
            <div class="track-info">
              <p id="TrackName">{{ track.name }}</p>
              <p id="ArtistName">{{ track.artists[0]?.name }}</p>
            </div>
          </div>
        </div>
        <button class="nav-button right" (click)="nextSlide()">›</button>
      </div>

    </div>

    <div class="carousel-display" *ngIf="topArtistsShort.length && topArtists">
      <div id="ToggleContainer">
        <div class="switch-container" [class.switched]="isArtistsToggled" (click)="toggleArtistSwitch()">
          <div class="switch-slider"></div>
          <div class="switch-options">
            <div class="switch-option" [class.active]="!isArtistsToggled">Last Month</div>
            <div class="switch-option" [class.active]="isArtistsToggled">6 Months</div>

          </div>
        </div>
      </div>
      <div id="carousel-container">
        <button class="nav-button left" (click)="prevSlide()">‹</button>
        <div class="carousel-track">
          <div class="carousel-card" *ngFor="let artist of visibleArtists(); let i = index" [ngClass]="getCardClass(i)">
            <div id="Image">
              <img [src]="artist.images[0]?.url" alt="Artist Image" />
              <div class="track-badge">{{ i }}</div>
            </div>
            <div class="track-info">
              <p id="TrackName">{{ artist.name }}</p>
              <p id="ArtistName">{{ artist.genres?.[0] ? toTitleCase(artist.genres[0]) : artist.genres[0] }}</p>
              <!-- <p id="ArtistName">{{ artist.genres[0] }}</p> -->
            </div>
          </div>
        </div>
        <button class="nav-button right" (click)="nextSlide()">›</button>
      </div>

    </div>

    <div class="dashboard-display" *ngIf="listeningHistory">
      <h1>Your Listening History</h1>
      <div id="dashContainer">
        <!-- Top row -->
        <div class="dashboard-row top">
          <!-- Empty Div (Top Left) -->
          <div class="dashboard-card now-playing-card">
            <div class="now-playing-card-top">{{ currentSongData ? "Currently Playing" : "Last Played" }}</div>
            <div id="current-track-cover">
              <img *ngIf="currentSong?.album?.images?.[0]?.url" [src]="currentSong.album.images[0].url"
                [alt]="currentSong.name + ' album cover'" />
            </div>

            <div id="current-track-data">
              <div id="current-track-name">{{ currentSong?.name }}</div>
              <div id="current-artist">{{ currentSong?.artists?.[0]?.name }}</div>
              <!-- <div id="current-duration">{{ formatDuration(currentSong?.duration_ms) }}</div> -->
            </div>

          </div>

          <!-- Selected Song in Recently Played -->
          <div class="dashboard-card song-card" *ngIf="(recentTracks?.length || 0) > 0">
            <div id="selected-track">
              <div class="album-cover" id="main-album-cover"><img *ngIf="selectedTrack.album?.images?.[0]?.url"
                  [src]="selectedTrack.album.images[0].url" [alt]="selectedTrack.name + ' album cover'" />
              </div>
              <h3 id="main-track-name">{{ selectedTrack.name }}</h3>
              <p class="played-time">Played at: {{ recentTracks[0]?.played_at | date: 'shortTime' }}</p>
            </div>
            <div id="selected-track-details" *ngIf="selectedTrack">
  <div id="artist"><span #scrollItem>By: {{ selectedTrack.artists?.[0]?.name }}</span></div>
  <div id="album-name"><span #scrollItem>Album: {{ selectedTrack.album?.name }}</span></div>
  <div id="duration"><span #scrollItem>Duration: {{ formatDuration(selectedTrack.duration_ms) }}</span></div>
  <div id="popularity"><span #scrollItem>Popularity: {{ popularityScale100to10(selectedTrack.popularity) }}/10</span></div>
</div>


          </div>
        </div>

        <!-- Bottom row -->
        <div class="dashboard-row bottom">
          <!-- Scrollable Past 50 Songs -->
          <div class="dashboard-card scrollable-card">
            <h3 style="margin-left:10px; font-size: larger;">Listening History</h3>
            <div class="scrollable-content" id="tracks-list">
              <div class="track-item" *ngFor="let track of recentTracks; let i = index" [attr.data-index]="i + 1"
                (click)="onTrackClick(track?.track?.id)">
                <div class="small-album-cover">
                  <img *ngIf="track?.track?.album?.images?.length" [src]="track?.track?.album?.images?.[0]?.url"
                    [alt]="track?.track?.name + ' album cover'" width="100"
                    (error)="$event.target.style.display='none'" />
                  <div class="placeholder-small" *ngIf="!track?.track?.album?.images?.length">♪</div>
                </div>
                <div class="track-info">
                  <span class="track-name" style="margin-bottom: 5px;">{{ track?.track?.name }}</span>
                  <span class="artist-name">{{ track?.track?.artists?.[0]?.name }}</span>
                </div>
                <span class="played-time">{{ track?.played_at | date: 'shortTime' }}</span>
              </div>
            </div>
          </div>

          <!-- Empty Divs (Right side) -->
          <div class="dashboard-card-column">
            <div id="hooked-on">
              <h3 style="align-items: center;">Hooked on</h3>
              <img [src]="topByFreq?.image" alt="{{ topByFreq?.name }} album cover" class="top-track-image">
              <div class="top-track-card">
                <div class="top-track-info">
                  <h4 class="track-name">{{ topByFreq?.name }}</h4>
                  <p class="artist-name">{{ topByFreq?.artist }}</p>
                </div>
                <div class="top-track-info">
                  <p class="play-count">Played {{ topByFreq?.count }} times in last 50</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>